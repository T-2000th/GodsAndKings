namespace = mr_MaliFlavor

country_event = {
	id = mr_MaliFlavor.1
	title = mr_MaliFlavor.1.t
	desc = mr_MaliFlavor.1.d
	picture = muslimgfx_COLONIZATION_eventPicture


	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					continent = south_america
				}
				save_event_target_as = mr_colonialism_base
			}
		}
	}

	option = {
		name = mr_MaliFlavor.1.a
		add_treasury = -50
		add_adm_power = -100
		trigger = {
			NOT = {
				num_of_owned_provinces_with = {
					value = 3
					OR = {
						continent = south_america
						continent = north_america
					}
				}
			}
		}
		custom_tooltip = two_random_province_colonies
		hidden_effect = {
			event_target:mr_colonialism_base = {
				random_empty_neighbor_province = {
					create_colony_mission_reward_province = {
						country = ROOT
					}
				 }	
			}
			event_target:mr_colonialism_base = {
				random_empty_neighbor_province = {
					create_colony_mission_reward_province = {
						country = ROOT
					}
				 }	
			}
		}
		
	}

	option = {
		name = mr_MaliFlavor.1.b
		event_target:mr_colonialism_base = {
			add_province_modifier = {
				name = expanded_colonial_efforts
				duration = -1
			}
		}
	}
}
country_event = {
	id = mr_MaliFlavor.2
	title = mr_MaliFlavor.2.t
	desc = mr_MaliFlavor.2.d
	picture = SONGHAI_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.2.a
		trigger = {
			any_province = {
				trade_goods = sugar
				NOT = {
					country_or_non_sovereign_subject_holds = ROOT
				}
				owner = {
					has_opinion = {
						who = ROOT
						value = 100
					}
					capital_scope = {
						NOT = {
							OR = {
								continent = south_america
								continent = north_america
							}
						}
					}
				}
			}
		}
		random_province = {
			limit = {
				OR = {
					area = dominica_area
					area = hispaniola_area
				}
				NOT = {
					OR = {
						trade_goods = sugar
						trade_goods = rum
					}
				}
				country_or_non_sovereign_subject_holds = ROOT
			}
			change_trade_goods = sugar
		}
		random_province = {
			limit = {
				trade_goods = sugar
				owner = {
					capital_scope = {
						NOT = {
							or = {
								continent = south_america
								continent = north_america
							}
						}
					}
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
			}
			add_province_modifier = {
				name = exporting_sugar
				duration = 3650
			}
		}
		add_treasury = -100
	}

	option = {
		name = mr_MaliFlavor.2.b
		trigger = {
			any_owned_province = {
				NOT = {
					OR = {
						continent = south_america
						continent = north_america
					}
				}
				trade_goods = sugar
			}
		}
		random_province = {
			limit = {
				OR = {
					area = dominica_area
					area = hispaniola_area
				}
				NOT = {
					OR = {
						trade_goods = sugar
						trade_goods = rum
					}
				}
				country_or_non_sovereign_subject_holds = ROOT
			}
			change_trade_goods = sugar
		}
		random_owned_province = {
			limit = {
				NOT = {
					or = {
						continent = south_america
						continent = north_america
					}
				}
				trade_goods = sugar
			}
			add_province_modifier = {
				name = exporting_sugar_1
				duration = 3650
			}
		}
		add_treasury = -50
	}
	option = {
		name = mr_MaliFlavor.2.c
	}
}
country_event = {
	id = mr_MaliFlavor.3
	title = mr_MaliFlavor.3.t
	desc = mr_MaliFlavor.3.d
	picture = SONGHAI_RULER_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = mr_MaliFlavor.3.a
		1096 = {
			cede_province = MAL
			add_core = MAL
			remove_core = ROOT
		}
		MAL = {
			set_country_flag = MAL_happy
			country_event = {
				id = mr_MaliFlavor.4
			}
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 1.25
				MAL = {
					diplomatic_reputation = 2
				}
			}
			modifier = {
				factor = 1.5
					owes_favors = { 
						who = MAL 
						value = 15 
			 	 	}
			}
			modifier = {
				factor = 1.5
				has_opinion_modifier = {
					who = MAL
					modifier = sent_gift
					value = 20
				}
			}
		}
	}
	option = {
		name = mr_MaliFlavor.3.b
		MAL = {
			add_trust = {
				who = ROOT
				value = -50
				mutual = yes
			}
			hidden_effect = {
				set_country_flag = MAL_mad
			}
		}
		MAL = {
			country_event = {
				id = mr_MaliFlavor.4
			}
		}
		ai_chance = {
			factor = 60
		}
	}
}

country_event = {
	id = mr_MaliFlavor.4
	title = mr_MaliFlavor.4.t
	desc = mr_MaliFlavor.4.d
	picture = SONGHAI_RULER_eventPicture

	is_triggered_only = yes

	option = {
		trigger = {
			has_country_flag = MAL_happy
		}
		name = mr_MaliFlavor.4.a
		custom_tooltip = gain_ability_to_diplo_vassalize_jolof
	}

	option = {
		trigger = {
			has_country_flag = MAL_mad
		}
		name = mr_MaliFlavor.4.b
		custom_tooltip = gain_ability_to_declare_war_for_farma
		break_alliance = JOL
		add_casus_belli = {
			type = cb_farma_subjugation_war
			target = JOL
		}
	}
}
country_event = {
	id = mr_MaliFlavor.5
	title = mr_MaliFlavor.5.t
	desc = mr_MaliFlavor.5.d
	picture = MALI_RULER_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			clr_country_flag = MAL_happy
		}
		
	}
	
	option = {
		name = mr_MaliFlavor.5.a
		MAL = {
			create_subject = {
				who = ROOT
				subject_type = farma_subject
			}
			change_variable = {
				which = integrated_FARM
				value = 1
			}
		}
		farma_dynamic_name_change_effect = yes
		MAL = {
			set_country_flag = mali_subject_jol
			country_event = {
				id = mr_MaliFlavor.6
			}
		}
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.6
				trust = { 
					who = MAL 
					value = 80 
				}
			}
			modifier = {
				factor = 1.6
					owes_favors = { 
						who = MAL 
						value = 50 
			 	 	}
			}
			modifier = {
				factor = 1.6
				trust = {
					who = MAL 
				 	value = 90 
				}
			}
		}
	}

	option = {
		name = mr_MaliFlavor.5.b
		MAL = {
			country_event = {
				id = mr_MaliFlavor.6
			}
		}
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				trust = { who = MAL value = 90 }
				owes_favors = { 
					who = MAL 
					value = 50 
				}
			}
		}
	}
}

country_event = {
	id = mr_MaliFlavor.6
	title = mr_MaliFlavor.6.t
	desc = mr_MaliFlavor.6.d
	picture = muslimgfx_SHIP_SAILING_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.6.a
		trigger = {
			has_country_flag = mali_subject_jol
		}
		add_prestige = 20
	}

	option = {
		trigger = {
			NOT = {
				has_country_flag = mali_subject_jol
			}	
		}
		name = mr_MaliFlavor.6.b
		custom_tooltip = gain_ability_to_declare_war_for_farma
		break_alliance = JOL
		add_casus_belli = {
			type = cb_farma_subjugation_war
			target = JOL
		}
	}
}
country_event = {
	id = mr_MaliFlavor.7
	title = mr_MaliFlavor.7.t
	desc = mr_MaliFlavor.7.d
	picture = muslimgfx_NAVAL_MILITARY_eventPicture
	
	fire_only_once = yes

	trigger = {
		OR = {
			north_america = { has_discovered = ROOT }
			south_america = { has_discovered = ROOT }
			new_world = { has_discovered = ROOT }
		}
		tag = MAL
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = mr_MaliFlavor.7.a
		pernambuco_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { 
					owner = {
						is_subject_of = ROOT
					}
				}
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		ceara_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { 
					owner = {
						is_subject_of = ROOT
					}
				}
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
	}
}
country_event = { #Bakirio Food Revolution
	id = mr_MaliFlavor.8
	title = mr_MaliFlavor.8.t
	desc = mr_MaliFlavor.8.d
	picture = AFRICAN_SOCIAL_GATHERING_eventPicture
	
	trigger = {
		has_global_flag = columbian_exchange_happened
	}

	mean_time_to_happen = {
		months = 120
	}

	option = {
		name = mr_MaliFlavor.8.a
		add_country_modifier = {
			name = new_malian_cuisine
			duration = 10950
		}
		custom_tooltip = further_food_innovations_to_come
		set_country_flag = malian_food_flag
	}
}

country_event = { #A Refereshing Change
	id = mr_MaliFlavor.9
	title = mr_MaliFlavor.9.t
	desc = mr_MaliFlavor.9.d
	picture = AFRICAN_SOCIAL_GATHERING_eventPicture

	trigger = {
		has_country_flag = malian_food_flag
		5210 = {
			country_or_non_sovereign_subject_holds = ROOT
		}
		calc_true_if = {
			all_province = {
				has_discovered = ROOT
				trade_goods = ginger
			}
			amount = 1
		}
	}

	mean_time_to_happen = {
		months = 300
	}

	option = {
		name = mr_MaliFlavor.9.a
		5210 = {
			change_trade_goods = ginger
			add_province_modifier = {
				name = home_of_ginger
				duration = -1
			}
			add_base_manpower = 2
			add_base_production = 2
		}
	}
}
country_event = { #The West African Cuisine Scene
	id = mr_MaliFlavor.10
	title = mr_MaliFlavor.10.t
	desc = mr_MaliFlavor.10.d
	picture = AFRICAN_SOCIAL_GATHERING_eventPicture

	trigger = {
		has_country_flag = malian_food_flag
		num_of_accepted_cultures = 2
		government_rank = 3
	}

	mean_time_to_happen = {
		months = 300
	}

	option = {
		name = mr_MaliFlavor.10.a
		add_country_modifier = {
			name = spreading_of_food
			duration = 10950
		}
	}
}

country_event = {
	id = mr_MaliFlavor.11
	title = mr_MaliFlavor.11.t
	desc = mr_MaliFlavor.11.d
	picture = FARMING_WIFE_eventPicture

	trigger = {
		has_country_flag = malian_food_flag
		num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
			OR = {
				region = mississippi_region
				region = southeast_america_region
			}
			trade_goods = maize
			has_production_building_trigger = yes
			value = 3
		}
	}

	option = {
		name = mr_MaliFlavor.11.a
		add_ruler_modifier = {
			name = the_best_grits_around 
			duration = -1
		}
		custom_tooltip = fried_grits
		tooltip = {
			add_province_modifier = {
				name = spreading_the_grits
				duration = 9125
			}
		}
		hidden_effect = {
			every_province = {
				limit = {
					OR = {
						region = mississippi_region
						region = southeast_america_region
					}
					country_or_non_sovereign_subject_holds = ROOT
					trade_goods = maize
					has_production_building_trigger = yes
				}
				add_province_modifier = {
					name = spreading_the_grits
					duration = 9125
				}
			}
		}
	}
}
country_event = {
	id = mr_MaliFlavor.114
	title = mr_MaliFlavor.114.t
	desc = mr_MaliFlavor.114.d
	picture = AFRICAN_DISCIPLINE_eventPicture

	is_triggered_only = yes

	fire_only_once = yes

	trigger = {		
		is_in_war = {
			casus_belli = cb_hausa_war
    		attacker_leader = ROOT
		}
		calc_true_if = {
			all_country = {
				culture = hausa
				is_subject_of = KNM
				liberty_desire = 50
			}
			amount = 1
		}
	}
	immediate = {
		hidden_effect = {
			KNM = {
				every_subject_country = {
					limit = {
						culture = hausa
						liberty_desire = 50
					}
					set_country_flag = release_in_event_MAL
				}
			}
		}
	}

	option = {
		name = mr_MaliFlavor.114.a
		KNM = {
			every_subject_country = {
				limit = {
					has_country_flag = release_in_event_MAL
				}
				grant_independence = yes
				PREV = {
					create_alliance = MAL
					join_all_offensive_wars_of = MAL
				}
				set_country_flag = to_be_annexed_MAL
				add_liberty_desire = -50
			}
		}
	}
}

country_event = {
	id = mr_MaliFlavor.14
	title = mr_MaliFlavor.14.t
	desc = mr_MaliFlavor.14.d
	picture = ASKIA_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.14.a
		trigger = {
			NOT = {
				HAU = {
					OR = {
						is_subject_of_type_with_overlord = {
							who = MAL
							type = farma_subject
						}
						is_subject_of_type_with_overlord = {
							who = MAL
							type = core_farma_subject
						}
					}
				}
			}
			NOT = {
				exists = HAU
			}
		}
		custom_tooltip = all_provinces_in_katsina_hausa_zazzau_transfer
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = to_be_annexed_MAL
					NOT = { tag = HAU }
				}
				every_owned_province = {
					add_core = HAU
					cede_province = HAU
				}
			}
			every_owned_province = {
				limit = {
					OR = {
						area = katsina_area
						area = hausa_area
						area = zazzau_area
					}
				}
				cede_province = HAU
				add_core = HAU
			}
		}
		create_subject = {
			subject = HAU
			subject_type = core_farma_subject
		}
		change_variable = {
			which = integrated_FARM
			value = 1
		}
		HAU = {
			add_historical_friend = MAL	
			change_country_color = {
				country = ROOT
			}
			farma_dynamic_name_change_effect = yes
		}
	}
	option = {
		name = mr_MaliFlavor.14.b
		trigger = {
			HAU = {
				OR = {
					is_subject_of_type_with_overlord = {
						who = MAL
						type = farma_subject
					}
					is_subject_of_type_with_overlord = {
						who = MAL
						type = core_farma_subject
					}
				}
			}
		}
		custom_tooltip = all_provinces_in_katsina_hausa_zazzau_transfer
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = to_be_annexed_MAL
					NOT = { tag = HAU }
				}
				every_owned_province = {
					add_core = HAU
					cede_province = HAU
				}
			}
			every_owned_province = {
				limit = {
					OR = {
						area = katsina_area
						area = hausa_area
						area = zazzau_area
					}
				}
				cede_province = HAU
				add_core = HAU
			}
		}
		create_subject = {
			subject = HAU
			subject_type = core_farma_subject
		}
		change_variable = {
			which = integrated_FARM
			value = 1
		}
		HAU = {
			change_country_color = {
				country = ROOT
			}
		}
	}
}
country_event = {
	id = mr_MaliFlavor.15
	title = mr_MaliFlavor.15.t
	desc = mr_MaliFlavor.15.d
	picture = AFRICAN_CHIEFTAIN_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.15.a
		GBI = {
			add_liberty_desire = -50
			change_tag = HAU
			add_historical_friend = MAL	
			farma_dynamic_name_change_effect = yes
		}
	}
}
country_event = {
	id = mr_MaliFlavor.115
	title = mr_MaliFlavor.115.t
	desc = mr_MaliFlavor.115.d
	picture = MALI_RULER_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.115.a
		KNM = {
			change_religion = ROOT
			kill_ruler = yes
			define_ruler = {
				dynasty = ROOT
				culture = ROOT
				religion = ROOT
			}
			add_liberty_desire = -35
		}
		random_province = {
			limit = {
				owned_by = KNM
			}
			spawn_rebels = {
				size = 3
				leader_dynasty = "Sayfawa"
				type = pretender_rebels
			}
		}
	}
	option = {
		name = mr_MaliFlavor.115.b
		add_liberty_desire = -15
		add_dip_power = 100
	}
}
country_event = {
	id = mr_MaliFlavor.116
	title = mr_MaliFlavor.116.t
	desc = mr_MaliFlavor.116.d
	picture = MUSLIM_PAGAN_DISPUTE_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.116.a
		create_subject = {
			subject_type = core_farma_subject
			who = YRE
		}
		change_variable = {
			which = integrated_FARM
			value = 1
		}
		YRE = {
			kill_ruler = yes
			define_ruler = {
				dynasty = "Ooni"
			}
			change_country_color = {
				country = ROOT
			}
			add_liberty_desire = -35
			farma_dynamic_name_change_effect = yes
		}
	}
}
country_event = { #The Court is Split!
	id = mr_MaliFlavor.12
	title = mr_MaliFlavor.12.t
	desc = mr_MaliFlavor.12.d
	picture = AFRICAN_KING_MEDIATING_eventPicture

	is_triggered_only = yes

	trigger = {
		NOT = {
			faction_influence = {
				faction = malian_court
				influence = 70
			}
		}
		NOT = {
			faction_influence = {
				faction = malian_guilds
				influence = 70
			}
		}
		NOT = {
			faction_influence = {
				faction = malian_merchants
				influence = 70
			}
		}
		tag = MAL
		has_reform = mr_malian_kingdom
	}

	option = {
		name = mr_MaliFlavor.12.a
		add_faction_influence = {
			faction = malian_court
			influence = 15
		}
		custom_tooltip = favor_the_guild_tt
		country_event = {
			id = mr_MaliFlavor.13
			days = 1
		}
		hidden_effect = {
			set_ruler_flag = support_the_court
		}
	}

	option = {
		name = mr_MaliFlavor.12.b
		add_faction_influence = {
			faction = malian_guilds
			influence = 15
		}
		custom_tooltip = favor_the_guild_tt
		country_event = {
			id = mr_MaliFlavor.13
			days = 1
		}
		hidden_effect = {
			set_ruler_flag = support_the_guilds
		}
	}
	option = {
		name = mr_MaliFlavor.12.b
		add_faction_influence = {
			faction = malian_merchants
			influence = 15
		}
		custom_tooltip = favor_the_guild_tt
		country_event = {
			id = mr_MaliFlavor.13
			days = 1
		}
		hidden_effect = {
			set_ruler_flag = support_the_merchants
		}
	}
}
country_event = { #Court Faction
	id = mr_MaliFlavor.13
	title = mr_MaliFlavor.13.t
	desc = mr_MaliFlavor.13.d
	picture = MALI_DECLINE_eventPicture
	
	is_triggered_only = yes

	option = { #Task A for Court
		trigger = {
			has_ruler_flag = support_the_court
		}
		name = mr_MaliFlavor.13.a
		custom_tooltip = how_to_complete_task_a_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_a_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_court
			set_ruler_flag = task_a
		}
	}

	option = { #Task B for Court
		trigger = {
			has_ruler_flag = support_the_court
		}
		name = mr_MaliFlavor.13.b
		custom_tooltip = how_to_complete_task_b_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_b_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_court
			set_ruler_flag = task_b
		}
	}
	option = { #Task B for Court
		trigger = {
			has_ruler_flag = support_the_court
		}
		name = mr_MaliFlavor.13.c
		custom_tooltip = how_to_complete_task_c_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_c_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_court
			set_ruler_flag = task_c
		}
	}

	option = { #Task D for Guilds
		trigger = {
			has_ruler_flag = support_the_guilds
		}
		name = mr_MaliFlavor.13.ed
		custom_tooltip = how_to_complete_task_d_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_d_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_guilds
			set_ruler_flag = task_d
			set_variable = {
				which = battle_counter_GUILDS
				value = 0
			}
		}
	}
	option = { #Task e for Guilds
		trigger = {
			has_ruler_flag = support_the_guilds
		}
		name = mr_MaliFlavor.13.e
		custom_tooltip = how_to_complete_task_e_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_e_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_guilds
			set_ruler_flag = task_e
			set_variable = {
				which = ruler_counter_GUILDS
				value = 0
			}
		}
	}
	option = { #Task f for Guilds
		trigger = {
			has_ruler_flag = support_the_guilds
		}
		name = mr_MaliFlavor.13.f
		custom_tooltip = how_to_complete_task_f_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_f_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_guilds
			set_ruler_flag = task_f
		}
	}
	option = { #Task g for Merchants
		trigger = {
			has_ruler_flag = support_the_merchants
		}
		name = mr_MaliFlavor.13.g
		custom_tooltip = how_to_complete_task_g_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_g_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_merchants
			set_ruler_flag = task_g
		}
	}
	option = { #Task h for Merchants
		trigger = {
			has_ruler_flag = support_the_merchants
		}
		name = mr_MaliFlavor.13.h
		custom_tooltip = how_to_complete_task_h_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_h_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_merchants
			set_ruler_flag = task_h
			set_variable = {
				which = mal_count_mosques
				value = 0
			}
		}
	}
	option = { #Task i for Merchants
		trigger = {
			has_ruler_flag = support_the_merchants
		}
		name = mr_MaliFlavor.13.i
		custom_tooltip = how_to_complete_task_i_and_reward
		tooltip = {
			add_ruler_modifier = {
				name = task_i_win
				duration = -1
			}
		}
		hidden_effect = {
			clr_ruler_flag = support_the_merchants
			set_ruler_flag = task_i
		}
	}
	option = { #Quit Option
		name = mr_MaliFlavor.13.zz
		hidden_effect = {
			clr_ruler_flag = support_the_guilds
			clr_ruler_flag = support_the_merchants
			clr_ruler_flag = support_the_court
		}
	}
}
country_event = {
	id = mr_MaliFlavor.16
	title = mr_MaliFlavor.16.t
	desc = mr_MaliFlavor.16.d
	picture = MALI_RULER_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_mali_flavor.16.a
		add_faction_influence = {
			faction = malian_court
			influence = 15
		}
		trigger = {
			OR = {
				has_ruler_flag = task_a
				has_ruler_flag = task_b
				has_ruler_flag = task_c
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_a
			}
			add_ruler_modifier = {
				name = task_a_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_b
			}
			add_ruler_modifier = {
				name = task_b_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_c
			}
			add_ruler_modifier = {
				name = task_c_win
				duration = -1
			}
		}
		hidden_effect = {
			change_variable = {
				which = NumOfFactionQuests
				value = 1
			}
			change_variable = {
				which = revolt_on_ruler_MAL
				value = 1
			}
			remove_quest_stuff = yes
		}
	}

	option = {
		name = mr_mali_flavor.16.b
		add_faction_influence = {
			faction = malian_guilds
			influence = 15
		}
		trigger = {
			OR = {
				has_ruler_flag = task_d
				has_ruler_flag = task_e
				has_ruler_flag = task_f
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_d
			}
			add_ruler_modifier = {
				name = task_d_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_e
			}
			add_ruler_modifier = {
				name = task_e_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_f
			}
			add_ruler_modifier = {
				name = task_f_win
				duration = -1
			}
		}
		hidden_effect = {
			change_variable = {
				which = NumOfFactionQuests
				value = 1
			}
			change_variable = {
				which = revolt_on_ruler_MAL
				value = 1
			}
			remove_quest_stuff = yes
		}
	}
	option = {
		name = mr_mali_flavor.16.c
		add_faction_influence = {
			faction = malian_merchants
			influence = 15
		}
		trigger = {
			OR = {
				has_ruler_flag = task_g
				has_ruler_flag = task_h
				has_ruler_flag = task_i
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_g
			}
			add_ruler_modifier = {
				name = task_g_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_h
			}
			add_ruler_modifier = {
				name = task_h_win
				duration = -1
			}
		}
		if = {
			limit = {
				has_ruler_flag = task_i
			}
			add_ruler_modifier = {
				name = task_i_win
				duration = -1
			}
		}
		hidden_effect = {
			change_variable = {
				which = NumOfFactionQuests
				value = 1
			}
			change_variable = {
				which = revolt_on_ruler_MAL
				value = 1
			}
			remove_quest_stuff = yes
		}
	}
}

country_event = {
	id = mr_MaliFlavor.17
	title = mr_MaliFlavor.17.t
	desc = mr_MaliFlavor.17.d
	picture = AFRICAN_BATTLE_eventPicture

	trigger = {
		OR = {
			had_ruler_flag = {
				flag = task_a
				days = 3650
			}
			had_ruler_flag = {
				flag = task_b
				days = 3650
			}
			had_ruler_flag = {
				flag = task_c
				days = 3650
			}
			had_ruler_flag = {
				flag = task_d
				days = 3650
			}
			had_ruler_flag = {
				flag = task_e
				days = 3650
			}
			had_ruler_flag = {
				flag = task_f
				days = 3650
			}
			had_ruler_flag = {
				flag = task_g
				days = 3650
			}
			had_ruler_flag = {
				flag = task_h
				days = 3650
			}
			had_ruler_flag = {
				flag = task_i
				days = 3650
			}
		}
	}
	
	option = {
		name = mr_MaliFlavor.17.a
		trigger = {
			OR = {
				had_ruler_flag = {
					flag = task_a
					days = 3650
				}
				had_ruler_flag = {
					flag = task_b
					days = 3650
				}
				had_ruler_flag = {
					flag = task_c
					days = 3650
				}
			}
		}
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
 			    size = 3
				leader_dynasty = "Keita"
			}
		}
		hidden_effect = {
			remove_quest_stuff = yes
		}
	}
	option = {
		name = mr_MaliFlavor.17.b
		trigger = {
			OR = {
				had_ruler_flag = {
					flag = task_d
					days = 3650
				}
				had_ruler_flag = {
					flag = task_e
					days = 3650
				}
				had_ruler_flag = {
					flag = task_f
					days = 3650
				}
			}
		}
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
 			    size = 3
				leader_dynasty = "Keita"
			}
		}
		hidden_effect = {
			remove_quest_stuff = yes
		}
	}
	option = {
		name = mr_MaliFlavor.17.c
		trigger = {
			OR = {
				had_ruler_flag = {
					flag = task_g
					days = 3650
				}
				had_ruler_flag = {
					flag = task_h
					days = 3650
				}
				had_ruler_flag = {
					flag = task_i
					days = 3650
				}
			}
		}
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
 			    size = 3
				leader_dynasty = "Keita"
			}
		}
		hidden_effect = {
			remove_quest_stuff = yes
		}
	}
}
country_event = {
	id = mr_MaliFlavor.18
	title = mr_MaliFlavor.18.t
	desc = mr_MaliFlavor.18.d
	picture = NZINGHA_eventPicture

	is_triggered_only = yes

	option = { #Kill the Kongo 
		name = mr_MaliFlavor.18.a
		
		reverse_add_opinion = {
			who = KON
			modifier = befriended_the_kongo
		}
		add_trust = {
			who = KON
			value = 10
			mutual = yes
		}
		set_country_flag = ally_congo_MAL
	}

	option = { #Befriend the Kongo
		name = mr_MaliFlavor.18.b
		coastal_kongo = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		kongo_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		angola_namibia_area = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { is_permanent_claim = ROOT }
			}
			add_permanent_claim = ROOT
		}
		set_country_flag = fight_congo_MAL
	}
}
country_event = {
	id = mr_MaliFlavor.19
	title = mr_MaliFlavor.19.t
	desc = mr_MaliFlavor.19.d
	picture = SONGHAI_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.19.a
		KON = {
			change_religion = ROOT
		}
		if = {
			limit = {
				4079 = {
					country_or_non_sovereign_subject_holds = KON
				}
			}
			4079 = {
				add_core = MAL
				remove_core = KON
				cede_province = MAL
			}
		}
		hidden_effect = {
			set_country_flag = integrate_KON_MAL
		}
		custom_tooltip = enable_integrating_KON
	}
}
country_event = {
	id = mr_MaliFlavor.20
	title = mr_MaliFlavor.20.t
	desc = mr_MaliFlavor.20.d
	picture = EP_ISLAND_eventPicture

	is_triggered_only = yes

	major = yes

	option = {
		name = mr_MaliFlavor.20.a
		change_price = {
			trade_goods = shellfish
			key = new_coinage
			value = 0.5
			duration = -1
		}
		add_country_modifier = {
			name = malian_shells_1
			duration = -1
		}
	}
}
country_event = {
	id = mr_MaliFlavor.21
	title = mr_MaliFlavor.21.t
	desc = mr_MaliFlavor.21.d
	picture = AFRICAN_REVOLT_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_variable = {
				which = revolt_on_ruler_MAL
				value = 0
			}
		}
		
	}

	option = {
		name = mr_MaliFlavor.21.a
		random_owned_province = {
			spawn_rebels = {
				type = particularist_rebels
				size = 2
				win = yes
			}
			
		}
		random_owned_province = {
			spawn_rebels = {
				type = particularist_rebels
				size = 2
				win = yes
			}
		}
	}
}
country_event = { #The Lords of the Fezzan
	id = mr_MaliFlavor.22
	title = mr_MaliFlavor.22.t
	desc = mr_MaliFlavor.22.d
	picture = SAHARA_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.22.a
		custom_tooltip = all_fezzan_north_sahara_ouled_nail
		tooltip = {
			add_province_modifier = {
				name = defeat_of_the_ibadi
				duration = -1
			}
		}
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = fezzan_area
						area = north_saharan_area
						area = ouled_nail_area
					}
				}
				add_province_modifier = {
					name = defeat_of_the_ibadi
					duration = -1
				}
			}
		}
	}

	option = {
		name = mr_MaliFlavor.22.b
		trigger = {
			FZA = {
				exists = no
			}
		}
		custom_tooltip = release_fza_as_a_core_farma
		disable_scholar_cost = yes
		hidden_effect = {
			release = FZA
			every_owned_province = {
				limit = {
					OR = {
						area = fezzan_area
						area = north_saharan_area
						area = ouled_nail_area
					}
				}
				add_core = FZA
				cede_province = FZA
			}
			create_subject = {
				subject_type = core_farma_subject
				who = FZA
				
			}
			FZA = {
				farma_dynamic_name_change_effect = yes
				change_country_color = {
					country = MAL
				}
			}
		}
	}
}
country_event = {
	id = mr_MaliFlavor.23
	title = mr_MaliFlavor.23.t
	desc = mr_MaliFlavor.23.d
	picture = maghrebi_FORT_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.23.a
		custom_tooltip = tunisian_ports_TT
		tooltip = {
			add_province_modifier = {
				name = tunisian_ports_MAL
				duration = -1
			}
		}
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = djerba_area
						area = tunisia_area
						has_port = yes
					}
				}
				add_province_modifier = {
					name = tunisian_ports_MAL
					duration = -1
				}
			}
		}
	}
	option = {
		name = mr_MaliFlavor.23.b
		trigger = {
			TUN = {
				exists = no
			}
		}
		custom_tooltip = tunisian_farma_tt
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						area = djerba_area
						area = tunisia_area
					}
				}
				cede_province = TUN
				add_core = TUN
			}
			create_subject = {
				subject_type = core_farma_subject
				who = FZA
			}
			set_country_flag = subjugated_tunisia_MAL
			TUN = {
				farma_dynamic_name_change_effect = yes
				change_country_color = {
					country = MAL
				}
			}
		}
	}
}

country_event = {
	id = mr_MaliFlavor.24
	title = mr_MaliFlavor.24.t
	desc = mr_MaliFlavor.24.d
	picture = EYALET_REBELLION_eventPicture

	is_triggered_only = yes

	option = { #Kill the Visiers
		name = mr_MaliFlavor.24.a
		add_country_modifier = {
			name = defeat_of_the_fatimids
			duration = -1
		}
		add_ruler_modifier = {
			name = fatimid_killer_Mal
			duration = -1
		}
	}

	option = {#Free Egypt
		name = mr_MaliFlavor.24.b
		delta_area = {
			cede_province = EG2
			add_core = EG2
		}
		bahari_area = {
			cede_province = EG2
			add_core = EG2
		}
		create_subject = {
			subject_type = core_farma_subject
			who = EG2
		}
		EG2 = {
			change_country_color = {
				country = ROOT
			}
		}
		al_wahat_area = {
			add_core = EG2
		}
		vostani_area = {
			add_core = EG2
		}
		said_area = {
			add_core = EG2
		}
		red_sea_coast_area = {
			add_core = EG2
		}
	}
}
country_event = { #Farma of Kongo
	id = mr_MaliFlavor.25
	title = mr_MaliFlavor.25.t
	desc = mr_MaliFlavor.25.d
	picture = AFRICAN_SOCIAL_GATHERING_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.25.a
		MAL = {
			create_subject = {
				who = ROOT
				subject_type = farma_subject
			}
			change_variable = {
				which = integrated_FARM
				value = 1
			}
		}
		farma_dynamic_name_change_effect = yes
		MAL = {
			set_country_flag = mali_subject_KON
			country_event = {
				id = mr_MaliFlavor.26
			}
		}
		ai_chance = {
			factor = 30
			modifier = {
				factor = 1.6
				trust = { 
					who = MAL 
					value = 90 
				}
			}
			modifier = {
				factor = 1.6
					owes_favors = { 
						who = MAL 
						value = 75 
			 	 	}
			}
			modifier = {
				factor = 1.6
				trust = {
					who = MAL 
				 	value = 100 
				}
			}
		}
	}

	option = {
		name = mr_MaliFlavor.25.b
		MAL = {
			country_event = {
				id = mr_MaliFlavor.26
			}
		}
		ai_chance = {
			factor = 70
			modifier = {
				factor = 0
				trust = { who = MAL value = 90 }
				owes_favors = { 
					who = MAL 
					value = 50 
				}
			}
		}
	}
}
country_event = { #Farma of Kongo Reaction
	id = mr_MaliFlavor.26
	title = mr_MaliFlavor.26.t
	desc = mr_MaliFlavor.26.d
	picture = AFRICAN_SOCIAL_GATHERING_eventPicture

	is_triggered_only = yes

	option = {
		name = mr_MaliFlavor.6.a
		trigger = {
			has_country_flag = mali_subject_KON
		}
		add_prestige = 20
	}

	option = {
		trigger = {
			NOT = {
				has_country_flag = mali_subject_KON
			}	
		}
		name = mr_MaliFlavor.6.b
		break_alliance = KON
		add_casus_belli = {
			type = cb_farma_subjugation_war
			target = KON
		}
	}
}

#Mean time to happen events
province_event = {
	id = mr_MaliFlavor.27
	title = mr_MaliFlavor.27.t
	desc = mr_MaliFlavor.27.d
	picture = muslimgfx_CITY_DEVELOPMENT_eventPicture


	trigger = {
		owner = {
			has_faction = malian_merchants
		}
		NOT = {
			religion = ROOT
		}
		NOT = {
			OR = {
				has_province_modifier = merchants_request_conversion
				owner = {
					has_country_modifier = merchant_request_denied
				}
			}
			

		}
	}

	mean_time_to_happen = {
		months = 12
	}

	is_mtth_scaled_to_size = 1


	option = {
		name = mr_MaliFlavor.27.a #Allow conversion
		owner = {
			add_faction_influence = {
				faction = malian_merchants
				influence = 5
			}
		}
		add_province_modifier = {
			name = merchants_request_conversion
			duration = 7300
		}
	}

	option = {
		name = mr_MaliFlavor.27.b #Deny Conversion
		owner = {
			add_country_modifier = {
				name = merchant_request_denied
				duration = 3650
			}
		}
	}
}